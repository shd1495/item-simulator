# 아이템 시뮬레이터
## 기술 스택
- Node.js
- Express.js
- MySQL - Prisma ORM
- JWT
- AWS EC2
- Yarn
## 실행 방법
- 서버 - yarn run start / pm2 start src/app.js
- 기능 - shd1495.store:3020/api/url
## 필수 기능
 - [x] 회원가입 API
 - [x] 로그인 API (JWT 토큰 발급)
 - [x] 캐릭터 생성 API (JWT 인증만 가능)
 - [x] 캐릭터 삭제 API (JWT 인증만 가능)
 - [x] 캐릭터 상세 조회 API (JWT 부분 인증)
 - [x] 아이템 생성 API
 - [x] 아이템 수정 API
 - [x] 아이템 목록 조회 API
 - [x] 아이템 상세 조회 API

## 도전 기능
 - [x] 아이템 구입 API (JWT 인증만 가능)
 - [x] 아이템 판매 API (JWT 인증만 가능)
 - [x] 캐릭터가 보유한 인벤토리 내 아이템 목록 조회 API (JWT 인증만 가능)
 - [x] 캐릭터가 장착한 아이템 목록 조회 API
 - [x] 아이템 장착 API (JWT 인증만 가능)
 - [x] 아이템 장착 해제 API (JWT 인증만 가능)
 - [x] 게임 머니 획득 API (JWT 인증만 가능)

## API 명세서
https://frosted-occupation-9b9.notion.site/Chapter-3-4e708ff6fe2b4cd3ab716a8d7d9a2fc9

## ERD
![ERD](https://github.com/user-attachments/assets/b5388caf-f189-4fa0-9d5d-7e374bc46da7)
## 트러블 슈팅 및 기능 구현 TIL

1. https://alie.kr/Alj2AIb
2. https://alie.kr/5UGIjpk
3. https://alie.kr/GZw2XEd
4. https://alie.kr/6taMaMx

## Q & A
- 1. 암호화 방식
   - Q, 비밀번호를 DB에 저장할 때 Hash를 이용했는데, Hash는 단방향 암호화와 양방향 암호화 중 어떤 암호화 방식에 해당할까요?
       - A, 단방향 암호화
   - Q, 비밀번호를 그냥 저장하지 않고 Hash 한 값을 저장 했을 때의 좋은 점은 무엇인가요?
       - A, 해싱한 비밀번호는 복호화하기 매우 어렵거나 불가능하기 때문에 무차별 대입 공격이나 데이터베이스가 노출되었을 때
        비밀번호 노출의 위험이 줄어듭니다.
- 2. 인증 방식
  - Q, JWT(Json Web Token)을 이용해 인증 기능을 했는데, 만약 Access Token이 노출되었을 경우 발생할 수 있는 문제점은 무엇일까요?
     - A, Access Token 자체가 사용자를 인증했다는 자격 증명이기 때문에 개인 정보를 탈취하거나 데이터를 조작하는 등의 문제가 발생합니다.
  - Q, 해당 문제점을 보완하기 위한 방법으로는 어떤 것이 있을까요?
     - A, MFA같은 다중 인증 시스템을 사용하던지 토큰의 만료 시간은 짧게 유지해 탈취된 토큰의 사용 시간을 줄이는 등의 방법이 있습니다.
- 3. 인증과 인가
  - Q, 인증과 인가가 무엇인지 각각 설명해 주세요.
     - A, 인증은 사용자, 디바이스 등의 신원을 확인하는 과정이고, 인가는 사용자, 디바이스 등이 리소스에 접근할 권한이 있는 지 검증하는 것 입니다.
  - Q, 위 API 구현 명세에서 인증을 필요로 하는 API와 그렇지 않은 API의 차이가 뭐라고 생각하시나요?
     - A, 본인의 계정의 정보는 본인만 생성,변경,삭제를 해야하기 때문에 이런 정보를 건드리는 API는 본인의 계정인지 인증받은 자격 증명인
       JWT 토큰을 전달함으로서 본인이란걸 증명하는 차이가 있습니다.
  - Q, 아이템 생성, 수정 API는 인증을 필요로 하지 않는다고 했지만 사실은 어느 API보다도 인증이 필요한 API입니다. 왜 그럴까요?
     - A, 게임으로 가정했을 때 밸런스 등에 대해 가장 근간이 되는게 아이템이기 때문에 일부 관계자만 접근할 수 있어야 합니다.
       경제적으로 생각했을 때도 아주 심각한 문제가 생길 수 있습니다
- 4. Htttp Status Code
  - Q, 과제를 진행하면서 사용한 Http Status Code를 모두 나열하고, 각각이 의미하는 것과 어떤 상황에 사용했는지 작성해 주세요.
     - Status 200 : OK 요청이 성공적으로 완료 되었을 때.
        - 조회, 수정 등 요청이 성공되었으나 새로운 리소스가 생성되지는 않았을 경우
          
     - Status 201 : Created 요청이 성공적으로 완료 되었으며 새 리소스가 생성되었을 때.
        - 캐릭터 생성, 계정 생성 등 DB에 리소스가 추가 되는 경우
          
     - Status 400 : Bad Request 서버가 요청을 이해하지 못했을 때.
        - 유효성 검사를 통과하지 못했거나 소지금이 부족하는 등 요청의 전제가 잘못되었을 경우
          
     - Status 401 : Unauthorized 요청자가 인증받지 못했을 때.
        - 로그인 시 비밀번호가 틀리거나 인증 받지않은 사용자가 접근하려고 했을 때
          
     - Status 403 : Forbidden 클라이언트가 접근 권한을 가지고 있지 않을 때.
        - 다른 계정의 캐릭터 인벤토리 조회같이 다른 사용자의 정보에 접근하려고 할 경우
          
     - Status 404 : Not Found 요청받은 리소스를 찾을 수 없을 때.
        - 요청 받은 캐릭터의 ID가 존재하지 않거나 아이템이 존재하지 않는 등 리소스를 찾을 수 없을 경우
          
     - Status 409 : Conflict 요청이 서버의 상태와 충돌했을 때.
        - 이미 존재하는 ID이거나 장착 중인 아이템을 또 장착할려고 하는 등 서버 내에서 충돌이 생기는 경우
          
     - Status 500 : Internal Server Error 서버가 처리 방법을 알지 못할 때
        - 예기치 못한 오류가 발생했을 경우
          
- 5. 게임 경제
  - Q, 현재는 간편한 구현을 위해 캐릭터 테이블에 money라는 게임 머니 컬럼만 추가하였습니다. 이렇게 되었을 때 어떠한 단점이 있을 수 있을까요?
     - RDB를 사용했기 때문에 재화의 종류를 추가할 경우에 과정이 쉽지 않고 머니에 변경 사항이 생길 때마다 캐릭터 정보까지 같이 조회해야하기 때문에
      성능적으로도 좋지 못합니다.

  - Q, 이렇게 하지 않고 다르게 구현할 수 있는 방법은 어떤 것이 있을까요?
     - 캐릭터의 id와 게임 머니 구성된 테이블을 새로 만들어 정규화하는게 좋을 것 같습니다.

  - Q, 아이템 구입 시에 가격을 클라이언트에서 입력하게 하면 어떠한 문제점이 있을 수 있을까요?
     - 아이템의 가격은 아이템의 능력에 따른 가치를 재화로 환산한 것이라고 생각하기 때문에 가격을 마음대로 변경할 수 있을 경우
       제작자의 레벨 디자인과 다르게 게임이 진행되고 음수로 입력했을 경우 돈을 오히려 얻을 수도 있기 때문에 게임 내 경제가 무너지게 됩니다.
## 어려웠던 점
- Auth 헤더로 토큰을 넘긴다는 개념이 잘 이해가 안되서 많이 찾아봤습니다.
 jwt를 Auth 헤더로 전달하는 방식으로 인가를 할 경우 세션스토리지 등 서버에서 jwt 토큰을 관리할 필요가 없기 때문에
 관련 라이브러리를 삭제하는 등의 해프닝이 있었습니다.

- 커밋 컨벤션을 정하고 과제를 진행했는데 평소 github desktop 같은 gui로만 커밋 푸쉬 등을 했었기 때문에
  gui로 자체적으로 커밋 컨벤션을 진행하다가 관련해서 변정섭 튜터님께 여쭈어보았더니 타입스크립트처럼 커밋 형식을 강제하는 husky commitlint 등의 라이브러리를
  추천해주셔서 commitlint husky 설정도 하고 사용도 했는데 github desktop으로는 커밋을 할 수 없는 문제가 생겨버려서
  터미널로 git add/ git commit 명령어를 사용해야해서 반강제로 연습하는 계기가 되었습니다.

- AWS EC2 인스턴스를 생성할 때 문제가 생겼습니다. 서울 지역 동북아b 가용 영역에서는 t2.micro를 사용할 수 없는 문제가 있어서 이유를 찾아보았더니
  원래는 가용 영역이 자동으로 설정되지만 저번에 강창민 튜터님이 올려주셨던 AWS 자료에서 IPv6 설정을 할 때 서브넷을 만들었는데 그 서브넷이 문제였습니다.
  자료에서는 할 필요 없다고 했었지만 호기심에 그만...
  이것 때문에 몇 시간을 해매서 기억에 남는데 AWS 콘솔 VPC에서 서브넷을 새로 만들고 만들 때 가용 영역을 다른 곳으로 설정하고 만든 후
  인스턴스를 생성할 때 새로 만든 서브넷으로 가용 영역을 설정하면 정상적으로 생성되었습니다. 이런 해프닝이 있었습니다.
